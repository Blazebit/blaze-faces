<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:b="http://blazebit.com/faces"
	xmlns:bm="http://blazebit.com/mobile"
	contentType="text/html"
    renderKitId="BLAZEFACES_MOBILE">

    <bm:page title="Chat">
        
        <f:facet name="postinit">
            <script type="text/javascript">
                //<![CDATA[
                    function handleMessage(data) {
                        var chatContent = $(BlazeFaces.escapeClientId('chatForm:content'));
                        chatContent.append(data + '<br />');

                        //keep scroll
                        chatContent.scrollTop(chatContent.height());
                    }
                //]]>
            </script>
        </f:facet>

        <!-- Main View -->
        <bm:view id="main" swatch="a">
            <bm:header title="Chat">
            </bm:header>

            <bm:content>
                <h:form id="chatForm">
                    
                    <b:outputPanel id="container">
                        <h:panelGroup rendered="#{chatView.loggedIn}" >
                            <b:outputPanel id="content" layout="block" style="width:100%;height:200px;overflow:auto"/>

                            <b:separator />

                            <b:inputText value="#{chatView.globalMessage}" styleClass="messageInput" />
                            <b:commandButton value="Send" actionListener="#{chatView.sendGlobal}" 
                                     oncomplete="$('.messageInput').val('')"/>
                        </h:panelGroup>
                    
                        <h:panelGroup rendered="#{not chatView.loggedIn}" >
                            <b:inputText id="username" value="#{chatView.username}" />
                            <b:watermark for="username" value="Username" />
                            
                            <b:separator />

                            <b:commandButton value="Login" icon="refresh" update="container"
                                              actionListener="#{chatView.login}" />
                        </h:panelGroup>
                    </b:outputPanel>
                            
                </h:form>
                
                <b:socket onMessage="handleMessage" channel="/chat" widgetVar="subscriber"/>
                
            </bm:content>

        </bm:view>

    </bm:page>
    
</f:view>